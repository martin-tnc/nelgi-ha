toggle_miboxer_hallway_leds:
  alias: Toggle MiBoxer hallway LEDs
  mode: single

  variables:
    leds:
      - light.miboxer_led_hallway_1
      - light.miboxer_led_hallway_2
    sensor: binary_sensor.hallway_leds_on # ← your 25 % helper

  sequence:
    - choose:
        # ── BRANCH A: sensor OFF  →  all lamps < 25 %  →  turn them ON
        - conditions:
            - condition: template
              value_template: "{{ is_state(sensor, 'off') }}"
          sequence:
            - service: light.turn_on
              target:
                entity_id: "{{ leds }}"
              data:
                brightness: 255 # full (0-255 scale), avoids pct bug
                kelvin: 3400

      # ── DEFAULT: sensor ON  →  some lamp ≥ 25 %  →  turn EVERYTHING off
      default:
        - service: light.turn_off
          target:
            entity_id: "{{ leds }}"
